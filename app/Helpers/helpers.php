<?php

if (!function_exists('getArraycompositeUnicodeToLatin')) {
    function getArraycompositeUnicodeToLatin()
    {
        return array(
            'a' => 'a',
            'á' => 'a',
            'à' => 'a',
            'â' => 'a',
            'ă' => 'a',
            'ã' => 'a',
            'ấ' => 'a',
            'ầ' => 'a',
            'ắ' => 'a',
            'ằ' => 'a',
            'ẫ' => 'a',
            'ẵ' => 'a',
            'ả' => 'a',
            'ẩ' => 'a',
            'ẳ' => 'a',
            'ạ' => 'a',
            'ậ' => 'a',
            'ặ' => 'a',
            'b' => 'b',
            'c' => 'c',
            'e' => 'e',
            'f' => 'f',
            'g' => 'g',
            'h' => 'h',
            'é' => 'e',
            'è' => 'e',
            'ê' => 'e',
            'ẽ' => 'e',
            'ế' => 'e',
            'ề' => 'e',
            'ễ' => 'e',
            'ẻ' => 'e',
            'ể' => 'e',
            'ẹ' => 'e',
            'ệ' => 'e',
            'i' => 'i',
            'í' => 'i',
            'ì' => 'i',
            'ĩ' => 'i',
            'ỉ' => 'i',
            'ị' => 'i',
            'j' => 'j',
            'k' => 'k',
            'l' => 'l',
            'm' => 'm',
            'n' => 'n',
            'o' => 'o',
            'ó' => 'o',
            'ò' => 'o',
            'ô' => 'o',
            'õ' => 'o',
            'ố' => 'o',
            'ồ' => 'o',
            'ỗ' => 'o',
            'ỏ' => 'o',
            'ơ' => 'o',
            'ổ' => 'o',
            'ọ' => 'o',
            'ớ' => 'o',
            'ờ' => 'o',
            'ỡ' => 'o',
            'ộ' => 'o',
            'ở' => 'o',
            'ợ' => 'o',
            'u' => 'u',
            'q' => 'q',
            'r' => 'r',
            's' => 's',
            't' => 't',
            'z' => 'z',
            'v' => 'v',
            'p' => 'p',
            'ú' => 'u',
            'ù' => 'u',
            'ũ' => 'u',
            'ủ' => 'u',
            'ư' => 'u',
            'ụ' => 'u',
            'ứ' => 'u',
            'ừ' => 'u',
            'ữ' => 'u',
            'ử' => 'u',
            'ự' => 'u',
            'ý' => 'y',
            'ỳ' => 'y',
            'ỹ' => 'y',
            'ỷ' => 'y',
            'ỵ' => 'y',
            'y' => 'y',
            'd' => 'd',
            '-' => '-',
            'w' => 'w',
            'x' => 'x',
            'đ' => 'd',
            'A' => 'A',
            'Á' => 'A',
            'À' => 'A',
            'Â' => 'A',
            'Ă' => 'A',
            'Ã' => 'A',
            'Ấ' => 'A',
            'Ầ' => 'A',
            'Ắ' => 'A',
            'Ằ' => 'A',
            'Ẫ' => 'A',
            'Ẵ' => 'A',
            'Ả' => 'A',
            'Ẩ' => 'A',
            'Ẳ' => 'A',
            'Ạ' => 'A',
            'Ậ' => 'A',
            'Ặ' => 'A',
            'B' => 'B',
            'C' => 'C',
            'E' => 'E',
            'F' => 'F',
            'G' => 'G',
            'H' => 'H',
            'É' => 'E',
            'È' => 'E',
            'Ê' => 'E',
            'Ẽ' => 'E',
            'Ế' => 'E',
            'Ề' => 'E',
            'Ễ' => 'E',
            'Ẻ' => 'E',
            'Ể' => 'E',
            'Ẹ' => 'E',
            'Ệ' => 'E',
            'I' => 'I',
            'Í' => 'I',
            'Ì' => 'I',
            'Ĩ' => 'I',
            'Ỉ' => 'I',
            'Ị' => 'I',
            'J' => 'J',
            'K' => 'K',
            'L' => 'L',
            'M' => 'M',
            'N' => 'N',
            'O' => 'O',
            'Ó' => 'O',
            'Ò' => 'O',
            'Ô' => 'O',
            'Õ' => 'O',
            'Ố' => 'O',
            'Ồ' => 'O',
            'Ỗ' => 'O',
            'Ỏ' => 'O',
            'Ơ' => 'O',
            'Ổ' => 'O',
            'Ọ' => 'O',
            'Ớ' => 'O',
            'Ờ' => 'O',
            'Ỡ' => 'O',
            'Ộ' => 'O',
            'Ở' => 'O',
            'Ợ' => 'O',
            'U' => 'U',
            'Q' => 'Q',
            'R' => 'R',
            'S' => 'S',
            'T' => 'T',
            'Z' => 'Z',
            'V' => 'V',
            'P' => 'P',
            'Ú' => 'U',
            'Ù' => 'U',
            'Ũ' => 'U',
            'Ủ' => 'U',
            'Ư' => 'U',
            'Ụ' => 'U',
            'Ứ' => 'U',
            'Ừ' => 'U',
            'Ữ' => 'U',
            'Ử' => 'U',
            'Ự' => 'U',
            'Ý' => 'Y',
            'Ỳ' => 'Y',
            'Ỹ' => 'Y',
            'Ỷ' => 'Y',
            'Y' => 'Y',
            'D' => 'D',
            '-' => '-',
            'W' => 'W',
            'X' => 'X',
            ',' => ',',
            "." => ".",
            ":" => ":",
            "%" => "%",
            "\r" => "\r",
            "\n" => "\n",
            "\"" => "\"",
            "/" => "/",
            "\\" => "\\",
            "}" => "}",
            "{" => "{",
            "[" => "[",
            "]" => "]",
            "(" => "(",
            ")" => ")",
            "&" => "&",
            'Đ' => 'D',
            '1' => '1',
            '2' => '2',
            '3' => '3',
            '4' => '4',
            '5' => '5',
            '6' => '6',
            '7' => '7',
            '8' => '8',
            '9' => '9',
            '0' => '0'
        );
    }
}

if (!function_exists('build_alias')){
    function build_alias($str){
        $result = '';
        $isSpace = 0;
        $arr_unicode = getArraycompositeUnicodeToLatin();

        $str = mb_strtolower($str, 'utf-8');
        $len = mb_strlen($str, 'utf-8');
        for ($i = 0; $i < $len; $i++) {
            $char = mb_substr($str, $i, 1, 'utf-8');
            if ($char == ' ' || $char == '-') {
                if ($isSpace == 0) {
                    $result .= "-";
                }
                $isSpace = 1;
            } else {
                if (array_key_exists($char, $arr_unicode)) {

                    $result .= $arr_unicode[$char];
                    $isSpace = 0;
                }
            }
        }
        $result = trim($result);
        $result = str_replace(' ', '-', $result);
        $result = str_replace(')', '', $result);
        $result = str_replace('(', '', $result);
        $result = str_replace('.', '', $result);
        $result = str_replace('/', '-', $result);
        $result = str_replace('–', '-', $result);
        $result = str_replace('--', '', $result);
        $result = preg_replace('/-(\-+)/', '-', $result);
        $result = preg_replace('/[^a-z0-9-]/', '', $result);
        $result = preg_replace('/(^-+)|(-+$)/', '', $result);
        $result = strtolower($result);

        if (empty($result)) {
            $result = strtolower(str_replace(' ', '-', preg_replace('/\s+/', ' ', $str)));
        }
        return $result;
    }
}